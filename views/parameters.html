<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title>Refine2Web</title>
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="/img/favicon.ico" type="image/x-icon" rel="icon" />

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet" />

  <!-- Boxicons CDN Link -->
  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />

  <!-- Bootsrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" />
  <!-- Animate CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- Bootstrap core JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!--Adding jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
  <!-- Template Main CSS File -->
  <link href="/css/style.css" rel="stylesheet" />

  <!-- =======================================================
  
    ======================================================== -->
</head>

<body class="toggle-sidebar" onload="setInitalCondition()">
  <!--#region ======= Setting ======= -->
  <div class="popup">
    <div class="container h-100">
      <i class="bi bi-x-circle option-close"></i>
      <div class="h-100">
        <!--=== Settings title ===-->
        <div class="row h-10">
          <h2>Setting</h2>
        </div>
        <!--=== Settings title ===-->

        <!--=== Settings body ===-->
        <div class="row h-90">
          <!--=== Alarm Toggle ===-->
          <div class="row h-10">
            <div class="col">Alarm:</div>
            <div class="col">
              <label class="switch">
                <input class="cb" type="checkbox" id="alarmChecbox" />
                <span class="slider round"></span>
              </label>
            </div>
          </div>
          <!--=== Alarm Toggle ===-->

          <!--=== GitHub Btn ===-->
          <div class="row h-10 gitBtn-pos">
            <div class="col w-10">
              <a role="button" target="_blank" href="https://github.com/Fillodallas/OpenIce2Web"
                class="btn fs-mini settings-btn github-btn">
                <i class="bx bxl-github"></i>
                GitHub
              </a>
            </div>
          </div>
          <!--=== GitHub Btn ===-->
        </div>
        <!--=== Settings body ===-->
      </div>
    </div>
  </div>
  <!--#endregion ======= End Setting ====== -->

  <!--#region ======= Sidebar ======= -->
  <div class="sidebar">
    <div class="logo-details">
      <img class="icon" alt="website logo" src="/img/logo.png" width="25" height="25" />
      <div class="logo_name">Refine2Web</div>
      <i class="bx bx-menu" id="btn"></i>
    </div>
    <ul class="nav-list">
      <li>
        <i class="bx bx-search"></i>
        <input type="text" placeholder="Search..." name="" />

        <span class="tooltip">Search</span>
      </li>
      <li>
        <a href="/">
          <i class="bx bx-grid-alt"></i>
          <span class="links_name">Dashboard</span>
        </a>
        <span class="tooltip">Dashboard</span>
      </li>
      <li>
        <a href="/monitor">
          <i class="bx bx-tv"></i>
          <span class="links_name">Monitor</span>
        </a>
        <span class="tooltip">Monitor</span>
      </li>
      <li>
        <a href="/parameters">
          <i class="bx bx-pie-chart-alt-2"></i>
          <span class="links_name">Parameters</span>
        </a>
        <span class="tooltip">Parameters</span>
      </li>

      <li>
        <a href="#">
          <i class="bx bx-chat"></i>
          <span class="links_name">Lorem Ipsum</span>
        </a>
        <span class="tooltip">Lorem</span>
      </li>

      <li>
        <a href="#">
          <i class="bx bx-folder"></i>
          <span class="links_name">Lorem Ipsum</span>
        </a>
        <span class="tooltip">Lorem</span>
      </li>
      <li>
        <a href="#">
          <i class="bx bx-cart-alt"></i>
          <span class="links_name">Lorem Ipsum</span>
        </a>
        <span class="tooltip">Lorem</span>
      </li>
      <li>
        <a href="#">
          <i class="bx bx-question-mark"></i>
          <span class="links_name">Lorem Ipsum</span>
        </a>
        <span class="tooltip">Lorem</span>
      </li>
      <li class="profile">
        <a href="#" id="show-login">
          <i class="bx bx-cog"></i>
          <span class="links_name">Setting</span>
        </a>
        <span class="tooltip">Setting</span>
      </li>
    </ul>
  </div>
  <!--#endregion ======= End Sidebar ======= -->

  <!-- Page Content-->
  <main id="main" class="main">
    <!-- Page Title -->
    <div class="pagetitle">
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item active">Parameters</li>
        </ol>
      </nav>
    </div>
    <!-- End Page Title -->



    <div class="cont">
      <div class="wrapper">
        <header>
          <h2>SpO2 Limits</h2>

        </header>
        <div class="value-input">
          <div class="field">
            <span>Min</span>
            <input type="number" class="input-min" value="84">
          </div>
          <div class="separator">-</div>
          <div class="field">
            <span>Max</span>
            <input type="number" class="input-max" value="95">
          </div>
        </div>
        <div class="slider-SPO2">

          <div class="postprogress"></div>
          <div class="preprogress"></div>
          <div class="progress"></div>
        </div>
        <div class="range-input">
          <input type="range" class="range-min" min="0" max="100" value="84" step="2">
          <input type="range" class="range-max" min="0" max="100" value="95" step="2">
        </div>

        <div class="btn-holder">
          <button type="button" class="btn btn-success" onclick="updateVal_SpO2();tempText('updateSpO2')" >Save</button>
          <p id="updateSpO2" class="animate__animated animate__faster"><i class='bx bx-check'></i> Values updated</p>
        </div>
      </div>
      <div>

  </main>

  <!-- Scripts -->
  <script>
    var exports = {};
  </script>
  <script src="js/main.js"></script>
  <script src="js/functions.js"></script>
  <script src="config/default.js"></script>
  <script src="config/safetyParam.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <!-- Socket Connection-->
  <script src="/socket.io/socket.io.js"></script>

  <script type="text/javascript">
    var socket = io(webHOST + ":" + webPORT);

    //#region Sezione ricezione e sroting dati

    var vlHR;

    socket.on("data", function (data) {
      //listen for an event called data, when data event happens it runs this function

      msg = data.toString();
      var arr = msg.split(":");
      var arrRR;
      var timHR, timRR;

      // arr[0] è il metricID
      // arr[1] è il valore letto
      // arr[2] è il tempo

      //#region Data distribution
      switch (arr[0]) {
        //#region Single data sorting

        case "MDC_CO2_RESP_RATE": // RR
          document.getElementById("sampleCO2RR").innerHTML = arr[1];
          document.getElementById("sideRR").innerHTML = arr[1];

          // Obtain the Integer value and the time value to be graphed
          vlRR = parseInt(arr[1]);
          timRR = extracDate(arr[2]);
          //(vlRR + " " + timRR)
          //setInterval(reLoad(RRChart, vlPO2, timPO2, 15), 1000);

          break;

        case "MDC_AWAY_CO2_ET": //AWCO2
          document.getElementById("sampleAWCO2").innerHTML = arr[1];

          break;

        case "MDC_PRESS_BLD_ART_ABP_SYS": // PSYS
          document.getElementById("samplepPSYS").innerHTML = arr[1];

          break;

        case "MDC_PRESS_BLD_ART_ABP_DIA": // PDIA
          document.getElementById("samplePDIA").innerHTML = arr[1];

          break;

        case "MDC_PULS_OXIM_SAT_O2": // PO2
          document.getElementById("samplePO2").innerHTML = arr[1];
          document.getElementById("sidePO2").innerHTML = arr[1];
          var vlPO2 = parseFloat(arr[1]);
          var timPO2 = extracDate(arr[2]);
          setInterval(reLoad(PO2Chart, vlPO2, timPO2, 15), 1000);

          break;

        case "MDC_PULS_OXIM_PULS_RATE": //  POPR
          document.getElementById("samplePOPR").innerHTML = arr[1];
          break;

        case "MDC_ECG_HEART_RATE": // HR
          //Get the data from the array when recive HR sample
          document.getElementById("sampleHR").innerHTML = arr[1];
          document.getElementById("sideHR").innerHTML = arr[1];

          // Obtain the Floating value and the time value to be graphed

          vlHR = parseFloat(arr[1]);
          timHR = extracDate(arr[2]);
          setInterval(reLoad(HRChart, vlHR, timHR, 15), 1000);

          break;

        case "MDC_TTHOR_RESP_RATE": // TTRR
          document.getElementById("sampleTTRR").innerHTML = arr[1];
          break;

        //#endregion Single data sorting

        //#region Waveform data sorting

        case "MDC_AWAY_CO2SIM":
          arr = maptoNum(arr[1]);
          Lab = Array.from(Array(arr.length).keys());

          break;

        case "MDC_ECG_LEAD_ISIM":
          arr = maptoNum(arr[1]);
          arr = arr.map(function (x) {
            return x / 1;
          });
          Lab = Array.from(Array(arr.length).keys());
          setInterval(reLoad(lIChart, arr, Lab, 200), 800);
          break;

        case "MDC_ECG_LEAD_IISIM":
          break;

        case "MDC_ECG_LEAD_IIISIM":
          arr = maptoNum(arr[1]);
          //console.log(arr);

          break;

        case "MDC_PRESS_BLD_ART_ABPSIM":
          arr = maptoNum(arr[1]);
          Lab = Array.from(Array(arr.length).keys());
          setInterval(reLoad(ARTABPChart, arr, Lab, 800), 1000);
          break;

        case "MDC_PULS_OXIM_PLETHSIM":
          arr = maptoNum(arr[1]);
          Lab = Array.from(Array(arr.length).keys());

          break;

        //#endregion Waveform data sorting
      }
      //#endregion Data distribution
    });

    //#endregion Sezione ricezione dati

    //#region Function Section

    const rangeInput = document.querySelectorAll(".range-input input"),
      valueInput = document.querySelectorAll(".value-input input"),
      rangedown = document.querySelector(".slider-SPO2 .preprogress"),
      range = document.querySelector(".slider-SPO2 .progress"),
      rangeup = document.querySelector(".slider-SPO2 .postprogress");
    let valueGap = 2;

    // Setto il range inizale prendendo i parametri dal file Json, dopo faccio che se non ho valori salvati nella memoria locale prendo questi!
    function setInitalCondition() {

      if ((localStorage.getItem("SPo2_Min") == null) || (localStorage.getItem("SPo2_Max") == null)){
        // Se uno dei due valori non è salvato in memoria locale inizializzo l'input utilizzanod valori slavati in safetyParam (SpO2min, SpO2max)
        rangeInput[0].value = SpO2min;
        rangeInput[1].value = SpO2max;

      } else {

        // Se ci sono entrambi setto il valore che trovo nel local storage 
        rangeInput[0].value = localStorage.getItem("SPo2_Min");
        rangeInput[1].value = localStorage.getItem("SPo2_Max");
      }

      updateBarScroll();

    }

    var SPo2_Max, SPo2_Min;

    valueInput.forEach(input => {
      input.addEventListener("input", e => {

        updateBarInput();

      });
    });

    // For each input in the bar we run the funtion to update the bar style
    rangeInput.forEach(input => {

      input.addEventListener("input", e => {
        updateBarScroll();

      });

    });

    //Function for the button
    function updateVal_SpO2() {
      localStorage.setItem("SPo2_Max", SPo2_Max);
      localStorage.setItem("SPo2_Min", SPo2_Min);
    }


    // Function to update bar style when scrolling:
    function updateBarScroll() {
      let minVal = parseInt(rangeInput[0].value),
        maxVal = parseInt(rangeInput[1].value);

      if ((maxVal - minVal) < valueGap) {
        if (e.target.className === "range-min") {
          rangeInput[0].value = maxVal - valueGap

        } else {
          rangeInput[1].value = minVal + valueGap;
        }
      } else {
        valueInput[0].value = minVal;
        valueInput[1].value = maxVal;


        SPo2_Min = (minVal / rangeInput[0].max) * 100;

        SPo2_Max = (maxVal / rangeInput[1].max) * 100;


        range.style.left = ((minVal / rangeInput[0].max) * 100) + "%";
        rangedown.style.right = (100 - (minVal / rangeInput[0].max) * 100) + "%";

        range.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%";
        //rangeup.style.left =(maxVal / rangeInput[1].max) * 100 + "%"; 

      }
    }


    // Function to update bar style when input value in box:
    function updateBarInput(){
      let minValue = parseInt(valueInput[0].value),
          maxValue = parseInt(valueInput[1].value);

        if ((maxValue - minValue >= valueGap) && maxValue <= rangeInput[1].max) {
          if (e.target.className === "input-min") {
            rangeInput[0].value = minValue;
            range.style.left = ((minValue / rangeInput[0].max) * 100) + "%";
            rangedown.style.right = (100 - (minValue / rangeInput[0].max) * 100) + "%";
            range.style.right = 100 - (maxValue / rangeInput[1].max) * 100 + "%";
        

          } else {
            rangeInput[1].value = maxValue;
            range.style.right = 100 - (maxValue / rangeInput[1].max) * 100 + "%";

          }
        }
    }
      //#endregion Function Section

      function tempText(idTxt){

             document.getElementById(idTxt).classList.add("animate__fadeIn");


             setTimeout(function(){
             document.getElementById(idTxt).classList.add("animate__fadeOut");
             document.getElementById(idTxt).classList.remove("animate__fadeIn");
             
             },700);
             setTimeout(function(){
                document.getElementById(idTxt).classList.remove("animate__fadeOut");
            },1000);



      }

  </script>
</body>

</html>